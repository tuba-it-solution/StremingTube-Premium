<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamTube Modern</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* CSS Variables - Default (Light Mode) */
        :root {
            --bg-base: #f9f9f9;
            --bg-surface: #ffffff;
            --bg-hover: #f0f0f0;
            --border-color: #e5e5e5;
            --text-primary: #0f0f0f;
            --text-secondary: #606060;
            --accent: #ff0000;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            --radius-lg: 12px;
            --radius-md: 8px;
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --bg-base: #0f0f0f;
            --bg-surface: #272727;
            --bg-hover: #3f3f3f;
            --border-color: #3d3d3d;
            --text-primary: #ffffff;
            --text-secondary: #aaaaaa;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Roboto, sans-serif; }

        body { background: var(--bg-base); color: var(--text-primary); overflow-x: hidden; transition: background 0.3s; }

        /* Navbar Modern */
        header {
            position: fixed; top: 0; width: 100%; height: 64px; background: var(--bg-surface);
            display: flex; align-items: center; justify-content: space-between; padding: 0 24px;
            z-index: 1000; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border-bottom: 1px solid var(--border-color);
            transition: background 0.3s;
        }

        .logo { font-size: 22px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 8px; letter-spacing: -0.5px; }
        .logo i { color: var(--accent); font-size: 28px; }

        .search-bar { display: flex; width: 45%; max-width: 650px; }
        .search-bar input { flex: 1; padding: 10px 18px; background: var(--bg-base); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 20px 0 0 20px; outline: none; font-size: 16px; transition: border 0.2s; }
        .search-bar input:focus { border-color: #065fd4; }
        .search-bar button { padding: 10px 24px; background: var(--bg-hover); border: 1px solid var(--border-color); border-left: none; border-radius: 0 20px 20px 0; color: var(--text-primary); cursor: pointer; transition: 0.2s; }
        .search-bar button:hover { background: var(--border-color); }

        .nav-icons { display: flex; gap: 15px; align-items: center; }
        .icon-btn { background: var(--bg-hover); border: none; color: var(--text-primary); font-size: 18px; cursor: pointer; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .icon-btn:hover { background: var(--border-color); transform: scale(1.05); }

        /* Kategori Scroll Horizontal */
        .categories { margin-top: 64px; padding: 12px 24px; display: flex; gap: 10px; overflow-x: auto; border-bottom: 1px solid var(--border-color); background: var(--bg-surface); scroll-behavior: smooth; }
        .categories::-webkit-scrollbar { display: none; }
        .cat-btn { padding: 8px 16px; background: var(--bg-hover); border-radius: var(--radius-md); color: var(--text-primary); cursor: pointer; white-space: nowrap; font-size: 14px; font-weight: 500; transition: 0.2s; border: 1px solid transparent; }
        .cat-btn.active { background: var(--text-primary); color: var(--bg-surface); }
        .cat-btn:hover:not(.active) { background: var(--border-color); }

        /* Main Grid & Responsiveness */
        .main-container { display: grid; grid-template-columns: 2fr 1fr; gap: 24px; padding: 24px; max-width: 1600px; margin: 0 auto; transition: 0.3s; }
        
        /* Theater Mode */
        .theater-mode { grid-template-columns: 100%; }
        .theater-mode .sidebar { display: none !important; }

        /* Video Player Section */
        .player-section { display: none; background: var(--bg-surface); padding: 16px; border-radius: var(--radius-lg); box-shadow: var(--shadow); }
        .video-wrapper { position: relative; padding-bottom: 56.25%; background: #000; border-radius: var(--radius-md); overflow: hidden; }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }

        .video-actions { display: flex; justify-content: space-between; align-items: flex-start; margin-top: 16px; gap: 10px; flex-wrap: wrap; }
        .video-title { font-size: 20px; font-weight: 600; line-height: 1.4; flex: 1; min-width: 250px; }
        .action-btns { display: flex; gap: 10px; }
        .action-btn { background: var(--bg-hover); color: var(--text-primary); border: none; padding: 10px 16px; border-radius: 20px; cursor: pointer; font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 8px; transition: 0.2s; }
        .action-btn:hover { background: var(--border-color); }

        .channel-info { margin-top: 16px; display: flex; align-items: center; gap: 12px; font-size: 15px; font-weight: 500; color: var(--text-primary); }
        .channel-avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--border-color); display: flex; align-items: center; justify-content: center; font-size: 20px; color: var(--text-secondary); }
        
        .video-description { margin-top: 16px; background: var(--bg-hover); padding: 16px; border-radius: var(--radius-md); font-size: 14px; color: var(--text-secondary); white-space: pre-wrap; max-height: 90px; overflow: hidden; cursor: pointer; transition: 0.3s; line-height: 1.5; }
        .video-description.open { max-height: 1000px; color: var(--text-primary); }

        /* Sidebar Modern */
        .sidebar { display: flex; flex-direction: column; gap: 16px; background: var(--bg-surface); padding: 16px; border-radius: var(--radius-lg); box-shadow: var(--shadow); }
        .sidebar-tabs { display: flex; gap: 8px; border-bottom: 1px solid var(--border-color); padding-bottom: 12px; }
        .tab-btn { background: none; border: none; color: var(--text-secondary); font-size: 14px; font-weight: 600; cursor: pointer; padding: 8px 12px; border-radius: var(--radius-md); transition: 0.2s; }
        .tab-btn.active { background: var(--text-primary); color: var(--bg-surface); }
        .tab-btn:hover:not(.active) { background: var(--bg-hover); }

        .action-clear { font-size: 12px; color: var(--accent); cursor: pointer; margin-left: auto; align-self: center; font-weight: bold; }

        /* Video List (Sidebar & Grid) */
        .video-list { display: flex; flex-direction: column; gap: 12px; }
        .video-item { display: flex; gap: 12px; cursor: pointer; padding: 8px; border-radius: var(--radius-md); transition: 0.2s; align-items: center; }
        .video-item:hover { background: var(--bg-hover); }
        .video-item img { width: 140px; height: 80px; border-radius: var(--radius-md); object-fit: cover; box-shadow: var(--shadow); }
        .video-info { flex: 1; }
        .video-item-title { font-size: 14px; font-weight: 600; margin-bottom: 4px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.3; }
        .video-item-channel { font-size: 13px; color: var(--text-secondary); }

        /* Home Grid */
        .home-grid { grid-column: 1 / -1; display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 24px; }
        .grid-card { cursor: pointer; background: var(--bg-surface); border-radius: var(--radius-lg); overflow: hidden; transition: 0.3s; box-shadow: var(--shadow); padding-bottom: 12px; }
        .grid-card:hover { transform: translateY(-4px); box-shadow: 0 8px 15px rgba(0,0,0,0.1); }
        .grid-card img { width: 100%; aspect-ratio: 16/9; object-fit: cover; }
        .grid-info { padding: 12px 16px 0; display: flex; gap: 12px; }
        .grid-text { flex: 1; }
        .grid-title { font-size: 16px; font-weight: 600; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.4; color: var(--text-primary); margin-bottom: 4px; }
        .grid-channel { font-size: 13px; color: var(--text-secondary); font-weight: 500; }

        /* Loading Skeleton Animation */
        .skeleton { background: linear-gradient(90deg, var(--bg-hover) 25%, var(--border-color) 50%, var(--bg-hover) 75%); background-size: 200% 100%; animation: loading 1.5s infinite; border-radius: var(--radius-md); }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        /* Responsiveness */
        @media (max-width: 1000px) {
            .main-container { grid-template-columns: 1fr; }
            .search-bar { width: 50%; }
            .sidebar { margin-top: 10px; }
            .video-item img { width: 120px; height: 70px; }
        }
        @media (max-width: 650px) {
            header { padding: 0 16px; }
            .logo span { display: none; }
            .search-bar { width: 100%; margin: 0 10px; max-width: none; }
            .icon-btn.hide-mobile { display: none; }
            .home-grid { grid-template-columns: 1fr; }
            .grid-card { box-shadow: none; border-bottom: 1px solid var(--border-color); border-radius: 0; padding-bottom: 16px; }
            .player-section { padding: 0; box-shadow: none; border-radius: 0; }
        }
    </style>
</head>
<body>

    <header>
        <div class="logo" onclick="goHome()"><i class="fab fa-youtube"></i> <span>StreamTube</span></div>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Cari musik, tutorial, podcast...">
            <button onclick="handleSearch()"><i class="fas fa-search"></i></button>
        </div>
        <div class="nav-icons">
            <button class="icon-btn" onclick="toggleTheme()" title="Mode Gelap/Terang"><i class="fas fa-moon" id="themeIcon"></i></button>
            <button class="icon-btn hide-mobile" onclick="showTab('watchLater')" title="Tonton Nanti"><i class="fas fa-clock"></i></button>
            <button class="icon-btn hide-mobile" onclick="showTab('history')" title="Riwayat"><i class="fas fa-history"></i></button>
        </div>
    </header>

    <div class="categories">
        <div class="cat-btn active" onclick="filterCategory('video viral indonesia terbaru', this)">Semua</div>
        <div class="cat-btn" onclick="filterCategory('Musik Pop Indonesia Terbaru', this)">Musik</div>
        <div class="cat-btn" onclick="filterCategory('Tutorial Web Programming', this)">Programming</div>
        <div class="cat-btn" onclick="filterCategory('Podcast Deddy Corbuzier', this)">Podcast</div>
        <div class="cat-btn" onclick="filterCategory('Berita Terkini Indonesia', this)">Berita</div>
        <div class="cat-btn" onclick="filterCategory('Game Walkthrough Indonesia', this)">Gaming</div>
    </div>

    <div class="main-container" id="mainLayout">
        <div class="player-section" id="playerSection">
            <div class="video-wrapper">
                <iframe id="videoPlayer" allow="autoplay; encrypted-media" allowfullscreen></iframe>
            </div>
            
            <div class="video-actions">
                <div class="video-title" id="videoTitle">Judul Video</div>
                <div class="action-btns">
                    <button class="action-btn" onclick="toggleTheaterMode()"><i class="fas fa-expand"></i> Teater</button>
                    <button class="action-btn" onclick="addToWatchLater()"><i class="fas fa-plus"></i> Simpan</button>
                    <button class="action-btn" onclick="shareVideo()"><i class="fas fa-share"></i> Bagikan</button>
                </div>
            </div>

            <div class="channel-info">
                <div class="channel-avatar"><i class="fas fa-user"></i></div>
                <span id="channelName">Nama Channel</span>
            </div>
            <div class="video-description" id="videoDesc" onclick="this.classList.toggle('open')" title="Klik untuk meluaskan/mengecilkan"></div>
        </div>

        <div class="sidebar" id="sidebarSection" style="display: none;">
            <div class="sidebar-tabs">
                <button class="tab-btn active" id="tab-related" onclick="showTab('related')">Terkait</button>
                <button class="tab-btn" id="tab-watchLater" onclick="showTab('watchLater')">Disimpan</button>
                <button class="tab-btn" id="tab-history" onclick="showTab('history')">Riwayat</button>
                <span id="clearBtn" class="action-clear" style="display:none;" onclick="clearCurrentList()">Hapus Semua</span>
            </div>
            <div class="video-list" id="sidebarList"></div>
        </div>

        <div class="home-grid" id="homeGrid"></div>
    </div>

    <script>
        // API KEY YOUTUBE ANDA
        const API_KEY = 'AIzaSyBwRfuNzEu6WhfWeWvE4V2hQEBGw_zVpYM'; 
        let currentVideo = null; 
        let currentTab = 'related';

        // --- THEME & INITIALIZATION ---
        window.onload = () => {
            initTheme();
            fetchVideos('video trending indonesia');
        };

        function initTheme() {
            const isDark = localStorage.getItem('theme') === 'dark';
            if(isDark) document.body.classList.add('dark-mode');
            updateThemeIcon(isDark);
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            updateThemeIcon(isDark);
        }

        function updateThemeIcon(isDark) {
            document.getElementById('themeIcon').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
        }

        // --- NAVIGATION & SEARCH ---
        document.getElementById('searchInput').addEventListener('keypress', e => { if (e.key === 'Enter') handleSearch(); });

        function goHome() {
            document.getElementById('playerSection').style.display = 'none';
            document.getElementById('sidebarSection').style.display = 'none';
            document.getElementById('mainLayout').classList.remove('theater-mode');
            document.title = "StreamTube Modern";
            fetchVideos('video trending indonesia');
        }

        function filterCategory(q, el) {
            document.querySelectorAll('.cat-btn').forEach(btn => btn.classList.remove('active'));
            el.classList.add('active');
            goHome(); fetchVideos(q);
        }

        function handleSearch() {
            const q = document.getElementById('searchInput').value;
            if(q) { goHome(); fetchVideos(q); }
        }

        // --- FETCHING DATA ---
        async function fetchVideos(query) {
            const grid = document.getElementById('homeGrid');
            grid.innerHTML = Array(12).fill(`<div class="grid-card skeleton" style="height:250px;"></div>`).join('');
            
            try {
                const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=16&q=${encodeURIComponent(query)}&type=video&key=${API_KEY}`;
                const res = await fetch(url);
                const data = await res.json();
                
                grid.innerHTML = '';
                data.items.forEach(item => {
                    grid.innerHTML += `
                        <div class="grid-card" onclick='playVideo("${item.id.videoId}", ${JSON.stringify(item.snippet).replace(/'/g, "&apos;")})'>
                            <img src="${item.snippet.thumbnails.high.url}" loading="lazy">
                            <div class="grid-info">
                                <div class="channel-avatar" style="width:36px;height:36px;font-size:16px;"><i class="fas fa-user"></i></div>
                                <div class="grid-text">
                                    <div class="grid-title">${item.snippet.title}</div>
                                    <div class="grid-channel">${item.snippet.channelTitle}</div>
                                </div>
                            </div>
                        </div>`;
                });
            } catch(e) { console.error(e); grid.innerHTML = '<div style="text-align:center;width:100%;grid-column:1/-1;">Gagal memuat video. Cek koneksi internet atau limit API Anda.</div>'; }
        }

        function playVideo(videoId, snippet) {
            currentVideo = { id: videoId, snippet: snippet };
            window.scrollTo({ top: 0, behavior: 'smooth' });

            document.getElementById('homeGrid').innerHTML = '';
            document.getElementById('playerSection').style.display = 'block';
            document.getElementById('sidebarSection').style.display = 'flex';

            // Ubah Title Browser
            document.title = snippet.title;

            // Setup Iframe (Localhost ready)
            const iframe = document.getElementById('videoPlayer');
            const originUrl = window.location.origin;
            iframe.src = `https://www.youtube-nocookie.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1&iv_load_policy=3&enablejsapi=1&origin=${originUrl}&widget_referrer=${originUrl}`;

            document.getElementById('videoTitle').innerText = snippet.title;
            document.getElementById('channelName').innerText = snippet.channelTitle;
            document.getElementById('videoDesc').innerText = snippet.description || "Tidak ada deskripsi untuk video ini.";

            saveToStorage('yt_history_modern', videoId, snippet);
            showTab('related');
        }

        // --- FEATURES (THEATER, SHARE, WATCH LATER, TABS) ---
        function toggleTheaterMode() {
            document.getElementById('mainLayout').classList.toggle('theater-mode');
        }

        function shareVideo() {
            if(!currentVideo) return;
            const url = `https://youtu.be/${currentVideo.id}`;
            navigator.clipboard.writeText(url).then(() => alert('Link video berhasil disalin: ' + url));
        }

        function addToWatchLater() {
            if(!currentVideo) return;
            saveToStorage('yt_watch_later_modern', currentVideo.id, currentVideo.snippet);
            alert('Video berhasil disimpan ke daftar Tonton Nanti!');
        }

        function saveToStorage(key, videoId, snippet) {
            let data = JSON.parse(localStorage.getItem(key)) || [];
            data = data.filter(v => v.id !== videoId);
            data.unshift({ id: videoId, snippet: snippet });
            if (data.length > 50) data.pop();
            localStorage.setItem(key, JSON.stringify(data));
        }

        // --- SIDEBAR TABS & LIST MANAGEMENT ---
        function showTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${tab}`)?.classList.add('active');
            
            const clearBtn = document.getElementById('clearBtn');
            clearBtn.style.display = (tab === 'related') ? 'none' : 'block';

            const list = document.getElementById('sidebarList');
            list.innerHTML = Array(6).fill(`<div class="video-item skeleton" style="height:80px;"></div>`).join('');

            document.getElementById('homeGrid').innerHTML = '';
            document.getElementById('sidebarSection').style.display = 'flex';

            if(tab === 'related' && currentVideo) fetchRelated(currentVideo.snippet.title);
            else if(tab === 'watchLater') renderStorageList('yt_watch_later_modern', 'Belum ada video yang disimpan.');
            else if(tab === 'history') renderStorageList('yt_history_modern', 'Belum ada riwayat tontonan.');
        }

        function renderStorageList(key, emptyMsg) {
            const list = document.getElementById('sidebarList');
            const data = JSON.parse(localStorage.getItem(key)) || [];
            
            if(data.length === 0) return list.innerHTML = `<p style="color:var(--text-secondary); text-align:center; padding: 20px;">${emptyMsg}</p>`;

            list.innerHTML = '';
            data.forEach(item => {
                list.innerHTML += `
                    <div class="video-item" onclick='playVideo("${item.id}", ${JSON.stringify(item.snippet).replace(/'/g, "&apos;")})'>
                        <img src="${item.snippet.thumbnails.medium.url}">
                        <div class="video-info">
                            <div class="video-item-title">${item.snippet.title}</div>
                            <div class="video-item-channel">${item.snippet.channelTitle}</div>
                        </div>
                    </div>`;
            });
        }

        function clearCurrentList() {
            const key = (currentTab === 'history') ? 'yt_history_modern' : 'yt_watch_later_modern';
            if(confirm('Apakah Anda yakin ingin menghapus semua daftar ini?')) {
                localStorage.removeItem(key);
                showTab(currentTab);
            }
        }

        async function fetchRelated(title) {
            const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=8&q=${encodeURIComponent(title)}&type=video&key=${API_KEY}`;
            const res = await fetch(url);
            const data = await res.json();
            
            const list = document.getElementById('sidebarList');
            list.innerHTML = '';
            data.items.forEach(item => {
                list.innerHTML += `
                    <div class="video-item" onclick='playVideo("${item.id.videoId}", ${JSON.stringify(item.snippet).replace(/'/g, "&apos;")})'>
                        <img src="${item.snippet.thumbnails.medium.url}">
                        <div class="video-info">
                            <div class="video-item-title">${item.snippet.title}</div>
                            <div class="video-item-channel">${item.snippet.channelTitle}</div>
                        </div>
                    </div>`;
            });
        }
    </script>
</body>
</html>

