<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Nonton Film dan Series Gratis Subtitle Indonesia">
    <title>TubaFlix - Nonton Tanpa Batas</title>
    <style>
        /* --- VARIABLES & RESET --- */
        :root {
            --bg-main: #141414;
            --bg-card: #1f1f1f;
            --primary: #e50914;
            --text-main: #ffffff;
            --text-sec: #b3b3b3;
            --nav-height: 70px;
            --radius: 8px;
            --shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* --- UTILITIES --- */
        .container { max-width: 1400px; margin: 0 auto; padding: 0 4%; }
        .hidden { display: none !important; }
        .btn {
            padding: 0.8rem 1.5rem; border: none; border-radius: 4px; 
            cursor: pointer; font-weight: bold; transition: 0.2s;
            display: inline-flex; align-items: center; gap: 8px;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #f40612; }
        .btn-sec { background: rgba(255,255,255,0.2); color: white; backdrop-filter: blur(5px); }
        .btn-sec:hover { background: rgba(255,255,255,0.3); }

        /* --- NAVBAR --- */
        .navbar {
            position: fixed; top: 0; width: 100%; height: var(--nav-height);
            z-index: 1000; transition: 0.3s;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 100%);
        }
        .navbar.scrolled { background-color: var(--bg-main); box-shadow: var(--shadow); }
        .nav-content {
            display: flex; justify-content: space-between; align-items: center; height: 100%;
        }
        .logo { font-size: 1.8rem; font-weight: 800; color: var(--primary); text-decoration: none; letter-spacing: 1px; }
        
        .nav-links { display: flex; gap: 20px; list-style: none; }
        .nav-links li a {
            color: var(--text-sec); text-decoration: none; font-size: 0.9rem; transition: 0.2s; cursor: pointer;
        }
        .nav-links li a:hover, .nav-links li a.active { color: white; font-weight: bold; }

        .search-box { position: relative; }
        .search-input {
            background: rgba(0,0,0,0.5); border: 1px solid #333; padding: 8px 15px 8px 35px;
            color: white; border-radius: 20px; transition: 0.3s; width: 200px;
        }
        .search-input:focus { width: 300px; border-color: var(--primary); background: black; }
        .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #aaa; }

        /* --- MOBILE MENU --- */
        .hamburger { display: none; cursor: pointer; font-size: 1.5rem; }
        
        /* --- HERO SECTION --- */
        .hero {
            height: 80vh; position: relative; display: flex; align-items: center;
            background-size: cover; background-position: center;
            margin-bottom: -100px; /* Overlap gradient */
        }
        .hero::after {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(0deg, var(--bg-main) 0%, rgba(20,20,20,0.6) 50%, rgba(20,20,20,0.4) 100%);
        }
        .hero-content { position: relative; z-index: 2; max-width: 600px; margin-top: 100px; }
        .hero-title { font-size: 3.5rem; margin-bottom: 1rem; line-height: 1.1; }
        .hero-meta { display: flex; gap: 15px; margin-bottom: 1.5rem; color: #46d369; font-weight: bold; }
        .hero-desc { color: white; font-size: 1.1rem; line-height: 1.5; margin-bottom: 2rem; 
                     display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }

        /* --- GRID LAYOUT --- */
        .section-title { font-size: 1.5rem; margin: 2rem 0 1rem; font-weight: 600; padding-left: 4%; border-left: 4px solid var(--primary); }
        .movie-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px; padding-bottom: 50px;
        }
        
        .movie-card {
            background: var(--bg-card); border-radius: var(--radius); overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s; cursor: pointer; position: relative;
        }
        .movie-card:hover { transform: scale(1.05); z-index: 10; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .poster-wrapper { position: relative; aspect-ratio: 2/3; overflow: hidden; }
        .poster-wrapper img { width: 100%; height: 100%; object-fit: cover; }
        .rating-badge {
            position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.8);
            color: #46d369; padding: 2px 6px; border-radius: 4px; font-weight: bold; font-size: 0.8rem;
        }
        .card-info { padding: 12px; }
        .card-title { font-size: 0.95rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 5px; }
        .card-meta { font-size: 0.8rem; color: var(--text-sec); display: flex; justify-content: space-between; }

        /* --- DETAIL PAGE --- */
        #detail-view {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background: var(--bg-main); z-index: 2000; overflow-y: auto;
            transform: translateY(100%); transition: transform 0.4s ease-in-out;
        }
        #detail-view.active { transform: translateY(0); }
        .back-btn {
            position: absolute; top: 20px; left: 20px; z-index: 2001;
            background: rgba(0,0,0,0.5); color: white; border: none;
            padding: 10px 15px; border-radius: 50%; cursor: pointer; font-size: 1.2rem;
        }
        .player-wrapper {
            position: relative; padding-top: 56.25%; /* 16:9 Aspect Ratio */
            background: black; margin-top: 60px;
        }
        .player-wrapper iframe {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;
        }
        .detail-info { padding: 30px 4%; }
        .episode-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; margin-top: 20px;
        }
        .episode-btn {
            background: #333; color: white; padding: 10px; text-align: center;
            border-radius: 4px; cursor: pointer; transition: 0.2s;
        }
        .episode-btn:hover, .episode-btn.active { background: var(--primary); }

        /* --- SKELETON LOADING --- */
        .skeleton { background: linear-gradient(90deg, #1f1f1f 25%, #2a2a2a 50%, #1f1f1f 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .sk-card { height: 320px; border-radius: var(--radius); }

        /* --- MEDIA QUERIES --- */
        @media (max-width: 768px) {
            .nav-links {
                position: fixed; top: var(--nav-height); left: -100%; width: 100%; height: calc(100vh - var(--nav-height));
                background: var(--bg-main); flex-direction: column; padding: 20px; transition: 0.3s;
            }
            .nav-links.active { left: 0; }
            .hamburger { display: block; }
            .search-input { width: 150px; }
            .search-input:focus { width: 180px; }
            .hero-title { font-size: 2rem; }
            .movie-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
        }
    </style>
</head>
<body>

    <nav class="navbar" id="navbar">
        <div class="container nav-content">
            <a href="#" class="logo" onclick="app.router.go('trending')">STREAMFLIX</a>
            
            <ul class="nav-links" id="navLinks">
                <li><a onclick="app.router.go('trending')" class="active">Home</a></li>
                <li><a onclick="app.router.go('indonesian-movies')">Film Indo</a></li>
                <li><a onclick="app.router.go('indonesian-drama')">Drama Indo</a></li>
                <li><a onclick="app.router.go('kdrama')">K-Drama</a></li>
                <li><a onclick="app.router.go('anime')">Anime</a></li>
            </ul>

            <div style="display: flex; gap: 15px; align-items: center;">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" id="searchInput" placeholder="Cari film...">
                </div>
                <div class="hamburger" onclick="toggleMenu()">‚ò∞</div>
            </div>
        </div>
    </nav>

    <main id="app">
        <div id="hero-slot"></div>

        <div class="container">
            <h2 id="page-title" class="section-title">Trending Now</h2>
            <div id="grid-content" class="movie-grid">
                </div>
            <div id="sentinel" style="height: 50px; margin-bottom: 50px;"></div>
        </div>
    </main>

    <div id="detail-view">
        <button class="back-btn" onclick="app.ui.closeDetail()">‚Üê Kembali</button>
        <div id="player-container" class="player-wrapper">
            </div>
        <div class="detail-info container">
            <h1 id="detail-title" style="margin-bottom: 10px;">Judul Film</h1>
            <div style="color: #46d369; font-weight: bold; margin-bottom: 15px;" id="detail-meta">2023 ‚Ä¢ Movie ‚Ä¢ ‚≠ê 8.5</div>
            <p id="detail-desc" style="color: #ccc; line-height: 1.6; max-width: 800px;">Deskripsi film...</p>
            
            <div id="episode-section" class="hidden">
                <h3 style="margin-top: 30px;">Episodes</h3>
                <div id="episode-list" class="episode-grid"></div>
            </div>
        </div>
    </div>

    <script>
        // --- API CONFIGURATION ---
        const API_CONFIG = {
            BASE_URL: 'https://zeldvorik.ru/apiv3/api.php',
            ENDPOINTS: {
                trending: 'trending',
                indoMovie: 'indonesian-movies',
                indoDrama: 'indonesian-drama',
                kdrama: 'kdrama',
                anime: 'anime',
                search: 'search',
                detail: 'detail'
            }
        };

        // --- UTILS ---
        const debounce = (func, wait) => {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        };

        // --- APP CORE ---
        class App {
            constructor() {
                this.state = {
                    currentAction: 'trending',
                    page: 1,
                    isLoading: false,
                    hasMore: true,
                    isSearch: false,
                    searchQuery: ''
                };
                this.ui = new UI();
                this.router = new Router(this);
                this.init();
            }

            init() {
                // Scroll Listener for Navbar
                window.addEventListener('scroll', () => {
                    const nav = document.getElementById('navbar');
                    if (window.scrollY > 50) nav.classList.add('scrolled');
                    else nav.classList.remove('scrolled');
                });

                // Search Listener
                document.getElementById('searchInput').addEventListener('input', debounce((e) => {
                    const query = e.target.value;
                    if (query.length > 2) {
                        this.search(query);
                    } else if (query.length === 0) {
                        this.router.go('trending');
                    }
                }, 800));

                // Infinite Scroll Observer
                this.observer = new IntersectionObserver((entries) => {
                    if (entries[0].isIntersecting && this.state.hasMore && !this.state.isLoading && !this.state.isSearch) {
                        this.loadMore();
                    }
                });
                this.observer.observe(document.getElementById('sentinel'));

                // Initial Load
                this.loadContent('trending');
            }

            async fetchData(action, page = 1, extraParams = '') {
                this.state.isLoading = true;
                if (page === 1) this.ui.showSkeleton();
                
                try {
                    const url = `${API_CONFIG.BASE_URL}?action=${action}&page=${page}${extraParams}`;
                    const res = await fetch(url);
                    const data = await res.json();
                    
                    this.state.isLoading = false;
                    return data;
                } catch (error) {
                    console.error("Fetch Error:", error);
                    this.state.isLoading = false;
                    this.ui.showError();
                    return null;
                }
            }

            async loadContent(action, reset = true) {
                if (reset) {
                    this.state.page = 1;
                    this.state.hasMore = true;
                    this.state.currentAction = action;
                    this.state.isSearch = false;
                    this.ui.clearGrid();
                    window.scrollTo(0, 0);
                    
                    // Update active nav
                    document.querySelectorAll('.nav-links a').forEach(el => el.classList.remove('active'));
                }

                const data = await this.fetchData(action, this.state.page);
                
                if (data && data.success) {
                    // Render Hero only on first page of Trending
                    if (action === 'trending' && this.state.page === 1) {
                        this.ui.renderHero(data.items[0]);
                    } else if (this.state.page === 1) {
                        this.ui.hideHero();
                    }

                    this.ui.renderGrid(data.items);
                    
                    // Check if has more (simple logic based on returned count)
                    if (data.items.length < 10) this.state.hasMore = false; 
                }
            }

            async loadMore() {
                this.state.page++;
                await this.loadContent(this.state.currentAction, false);
            }

            async search(query) {
                this.state.isSearch = true;
                this.state.searchQuery = query;
                this.ui.clearGrid();
                this.ui.hideHero();
                document.getElementById('page-title').innerText = `Search: "${query}"`;
                
                const data = await this.fetchData('search', 1, `&q=${query}`);
                if (data && data.items) {
                    this.ui.renderGrid(data.items);
                }
            }

            async openDetail(detailPath) {
                const data = await this.fetchData('detail', 1, `&detailPath=${detailPath}`);
                if (data && data.items && data.items.length > 0) {
                    this.ui.renderDetail(data.items[0]); // Usually detail returns array with 1 item or object
                }
            }
        }

        // --- UI RENDERER ---
        class UI {
            constructor() {
                this.grid = document.getElementById('grid-content');
                this.heroSlot = document.getElementById('hero-slot');
                this.detailView = document.getElementById('detail-view');
            }

            clearGrid() { this.grid.innerHTML = ''; }

            hideHero() { this.heroSlot.innerHTML = ''; }

            showSkeleton() {
                let html = '';
                for(let i=0; i<8; i++) html += `<div class="skeleton sk-card"></div>`;
                this.grid.innerHTML = html;
            }
            
            removeSkeleton() {
                const skels = document.querySelectorAll('.skeleton');
                skels.forEach(el => el.remove());
            }

            showError() {
                this.grid.innerHTML = '<div style="text-align:center; padding: 50px; width: 100%; grid-column: 1/-1;"><h3>Gagal memuat data. Coba lagi nanti.</h3></div>';
            }

            renderHero(item) {
                if(!item) return;
                this.heroSlot.innerHTML = `
                    <div class="hero" style="background-image: url('${item.poster}')">
                        <div class="container hero-content">
                            <h1 class="hero-title">${item.title}</h1>
                            <div class="hero-meta">
                                <span>${item.year}</span>
                                <span>${item.rating || 'N/A'} ‚≠ê</span>
                                <span>${item.type || 'Movie'}</span>
                            </div>
                            <div class="hero-desc">Tonton ${item.title} sekarang. Streaming kualitas HD dengan subtitle Indonesia. Film trending nomor 1 minggu ini.</div>
                            <button class="btn btn-primary" onclick="app.openDetail('${item.detailPath}')">‚ñ∂ Putar Sekarang</button>
                            <button class="btn btn-sec">‚Ñπ Selengkapnya</button>
                        </div>
                    </div>
                `;
            }

            renderGrid(items) {
                this.removeSkeleton();
                items.forEach(item => {
                    // Filter data sampah
                    if(!item.poster || !item.title) return;

                    const card = document.createElement('div');
                    card.className = 'movie-card';
                    card.onclick = () => app.openDetail(item.detailPath);
                    card.innerHTML = `
                        <div class="poster-wrapper">
                            <img src="${item.poster}" loading="lazy" alt="${item.title}">
                            ${item.rating ? `<div class="rating-badge">${item.rating}</div>` : ''}
                        </div>
                        <div class="card-info">
                            <div class="card-title">${item.title}</div>
                            <div class="card-meta">
                                <span>${item.year || ''}</span>
                                <span>${item.type || 'Movie'}</span>
                            </div>
                        </div>
                    `;
                    this.grid.appendChild(card);
                });
            }

            renderDetail(data) {
                // Reset Scroll
                this.detailView.scrollTop = 0;
                
                // Populate Info
                document.getElementById('detail-title').innerText = data.title;
                document.getElementById('detail-meta').innerText = `${data.year || ''} ‚Ä¢ ${data.genre || ''} ‚Ä¢ ‚≠ê ${data.rating || 'N/A'}`;
                document.getElementById('detail-desc').innerText = data.description || 'Tidak ada deskripsi.';

                // Setup Player (Priority: streamUrl -> playerUrl)
                const playerUrl = data.streamUrl || data.playerUrl;
                const playerContainer = document.getElementById('player-container');
                
                if (playerUrl) {
                    playerContainer.innerHTML = `<iframe src="${playerUrl}" allowfullscreen allow="autoplay; encrypted-media"></iframe>`;
                } else {
                    playerContainer.innerHTML = `<div style="display:flex;align-items:center;justify-content:center;height:100%;color:white;">Video tidak tersedia</div>`;
                }

                // Handle Episodes if TV Series
                const epSection = document.getElementById('episode-section');
                const epList = document.getElementById('episode-list');
                
                if (data.episodes && data.episodes.length > 0) {
                    epSection.classList.remove('hidden');
                    epList.innerHTML = '';
                    data.episodes.forEach(ep => {
                        const btn = document.createElement('div');
                        btn.className = 'episode-btn';
                        btn.innerText = `Ep ${ep.episode}`;
                        btn.onclick = () => {
                            // Change player source if episode clicked
                            document.querySelectorAll('.episode-btn').forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');
                            playerContainer.innerHTML = `<iframe src="${ep.url}" allowfullscreen></iframe>`;
                        };
                        epList.appendChild(btn);
                    });
                } else {
                    epSection.classList.add('hidden');
                }

                // Show Overlay
                this.detailView.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            closeDetail() {
                this.detailView.classList.remove('active');
                document.body.style.overflow = 'auto';
                // Stop video by clearing iframe
                setTimeout(() => {
                    document.getElementById('player-container').innerHTML = '';
                }, 400);
            }
        }

        // --- ROUTER HELPER ---
        class Router {
            constructor(appContext) {
                this.app = appContext;
            }

            go(action) {
                // Update Title & Nav
                const titles = {
                    'trending': 'Trending Now',
                    'indonesian-movies': 'Film Indonesia',
                    'indonesian-drama': 'Drama Indonesia',
                    'kdrama': 'Korean Drama',
                    'anime': 'Anime Series'
                };
                
                document.getElementById('page-title').innerText = titles[action] || 'Movies';
                
                // Call App Load
                this.app.loadContent(action);
                
                // Update Menu Mobile
                const navLinks = document.getElementById('navLinks');
                if(navLinks.classList.contains('active')) toggleMenu();
            }
        }

        // --- INIT ---
        function toggleMenu() {
            document.getElementById('navLinks').classList.toggle('active');
        }

        const app = new App();

    </script>
</body>
</html>
